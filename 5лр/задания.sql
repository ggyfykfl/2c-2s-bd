CREATE DATABASE IF NOT EXISTS BaseMysql_Kl;
USE BaseMysql_Kl;


CREATE TABLE Работники (
    ID_работника INT AUTO_INCREMENT PRIMARY KEY,
    Фамилия NVARCHAR(30) NOT NULL,
    Имя NVARCHAR(30) NOT NULL,
    Отчество NVARCHAR(30),
    Год_рождения INT NOT NULL,
    Год_поступления INT NOT NULL,
    Стаж INT,
    Должность NVARCHAR(50) NOT NULL,
    Пол NVARCHAR(1) NOT NULL,
    Адрес NVARCHAR(100),
    Город NVARCHAR(50),
    Телефон NVARCHAR(13)
);

USE BaseMysql_Kl;
CREATE TABLE Спектакли (
    ID_спектакля INT AUTO_INCREMENT PRIMARY KEY,
    Название NVARCHAR(50) NOT NULL,
    Режиссер INT,
    Художник INT,
    Дирижер INT,
    Автор INT,
    Жанр NVARCHAR(30) NOT NULL,
    Тип NVARCHAR(30) NOT NULL,
    Цена DECIMAL(10, 2),
    FOREIGN KEY (Режиссер) REFERENCES Работники(ID_работника),
    FOREIGN KEY (Художник) REFERENCES Работники(ID_работника),
    FOREIGN KEY (Дирижер) REFERENCES Работники(ID_работника),
    FOREIGN KEY (Автор) REFERENCES Работники(ID_работника)
);

USE BaseMysql_Kl;
CREATE TABLE Гастроли (
    ID_гастроли INT AUTO_INCREMENT PRIMARY KEY,
    Название NVARCHAR(50) NOT NULL,
    Дата_начала DATE NOT NULL,
    Дата_окончания DATE NOT NULL,
    Место_проведения NVARCHAR(100) NOT NULL,
    ID_спектакля INT,
    FOREIGN KEY (ID_спектакля) REFERENCES Спектакли(ID_спектакля)
);

USE BaseMysql_Kl;
INSERT INTO Работники (Фамилия, Имя, Отчество, Год_рождения, Год_поступления, Стаж, Должность, Пол, Адрес, Город, Телефон)
VALUES 
('Иванов', 'Алексей', 'Петрович', 1980, 2005, 20, 'Режиссер', 'М', 'ул. Ленина, 1', 'Москва', '89161234567'),
('Смирнова', 'Елена', 'Викторовна', 1985, 2010, 15, 'Художник', 'Ж', 'ул. Пушкина, 15', 'Санкт-Петербург', '89161234568'),
('Кузнецов', 'Игорь', 'Сергеевич', 1975, 2000, 25, 'Дирижер', 'М', 'ул. Чехова, 22', 'Казань', '89161234569'),
('Петрова', 'Марина', 'Алексеевна', 1990, 2012, 12, 'Автор', 'Ж', 'ул. Гоголя, 8', 'Новосибирск', '89161234570');

USE BaseMysql_Kl;
INSERT INTO Спектакли (Название, Режиссер, Художник, Дирижер, Автор, Жанр, Тип, Цена)
VALUES 
('Лебединое озеро', 1, 2, 3, 4, 'Балет', 'Классический', 1500.00),
('Гамлет', 1, 2, 3, 4, 'Драма', 'Классический', 1200.00);

USE BaseMysql_Kl;
INSERT INTO Гастроли (Название, Дата_начала, Дата_окончания, Место_проведения, ID_спектакля)
VALUES
('Весенние гастроли', '2025-05-01', '2025-05-15', 'Театр драмы, Екатеринбург', 1),
('Летний тур', '2025-06-10', '2025-06-25', 'Театр оперы, Казань', 2);

SELECT * FROM Работники;
SELECT * FROM Спектакли;
SELECT * FROM Гастроли;

SELECT 
    С.ID_спектакля,
    С.Название AS Название_спектакля,
    Р.Фамилия,
    Р.Имя,
    Р.Отчество,
    С.Жанр,
    С.Тип,
    С.Цена
FROM Спектакли С
INNER JOIN Работники Р ON С.Режиссер = Р.ID_работника;


SELECT 
    Г.ID_гастроли,
    Г.Название AS Название_гастроли,
    Г.Дата_начала,
    Г.Дата_окончания,
    Г.Место_проведения,
    С.Название AS Название_спектакля
FROM Гастроли Г
LEFT OUTER JOIN Спектакли С ON Г.ID_спектакля = С.ID_спектакля;

SELECT 
    Г.Название AS Название_гастроли,
    С.Название AS Название_спектакля,
    А.Фамилия AS Автор_Фамилия,
    А.Имя AS Автор_Имя,
    А.Отчество AS Автор_Отчество
FROM Гастроли Г
INNER JOIN Спектакли С ON Г.ID_спектакля = С.ID_спектакля
INNER JOIN Работники А ON С.Автор = А.ID_работника;

SELECT 
    Жанр,
    COUNT(*) AS Количество_спектаклей,
    AVG(Цена) AS Средняя_цена
FROM Спектакли
GROUP BY Жанр;

SELECT *
FROM Работники
WHERE ID_работника IN (
    SELECT Режиссер
    FROM Спектакли
    WHERE Режиссер IS NOT NULL
);

SELECT 
    Фамилия,
    Имя,
    Отчество,
    (SELECT COUNT(*) 
     FROM Спектакли 
     WHERE Режиссер = Работники.ID_работника) AS Количество_спектаклей
FROM Работники;

SELECT Жанр, COUNT(*) AS Количество
FROM Спектакли
GROUP BY Жанр
HAVING COUNT(*) > 1;
